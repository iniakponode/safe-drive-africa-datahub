{# app/templates/pages/index.html #}
{% extends "base.html" %}

{% block title %}Dashboard - DataHub{% endblock %}

{% block content %}
  <h1 class="mb-4">Experiment Data Overview</h1>

  <!-- Summary Cards -->
  <div class="row">
    <div class="col-md-3 mb-3">
      {% from "partials/card.html" import render_card %}
      {{ render_card("Total Drivers", aggregates.total_drivers, "bg-primary") }}
    </div>
    <div class="col-md-3 mb-3">
      {{ render_card("Total Trips", aggregates.total_trips, "bg-secondary") }}
    </div>
    <div class="col-md-3 mb-3">
      {{ render_card("Total Sensor Data", aggregates.total_sensor_data, "bg-success") }}
    </div>
    <div class="col-md-3 mb-3">
      {{ render_card("Valid Sensor Data", aggregates.total_valid_sensor_data, "bg-info") }}
    </div>
    <div class="col-md-3 mb-3">
      {{ render_card("Invalid Sensor Data", aggregates.invalid_sensor_data_count, "bg-danger") }}
    </div>
  </div> 

  {# Build table data for each (driver, trip) row #}
  {% set table_rows = [] %}
{% for row in aggregates.driver_trip_sensor_stats %}
  {% set new_row = {
    "Driver Email": row.driverEmail,
    "Trip ID": row.tripId,
    "Total": row.totalSensorDataCount,
    "Invalid": row.invalidSensorDataCount,
    "Valid": row.validSensorDataCount
  } %}
  {% set table_rows = table_rows + [new_row] %}
{% endfor %}

{% from "partials/table.html" import render_table %}
{{ render_table(
    "Sensor Data Per Trip (Per Driver)",
    ["Driver Email", "Trip ID", "Total", "Invalid", "Valid"],
    table_rows
) }}

{% endblock %}